
<h2 class="tc pv5"><?php echo $_cbase['sys_name']; ?> [V<?php echo $_cbase['sys']['ver']; ?>] - 安装程序</h2>

<form id="fmsupset" name="fmsupset" method="post" action="?act=EditDB">
<div>
  <p>安装程序-安装步骤</p>
  <table width="100%" border="1" class="tblist">
    <tr>
      <th width="20%">步骤</th>
      <th>信息</th>
      <th width="10%">状态</th>
    </tr>
    
    <?php if($cmynow['res']==FLAGNO){ ?>
    <tr class="tc">
        <td>[0]配置错误信息</td>
        <td class="msg"><?php echo $cmynow['info']; ?></td>
        <td class="tc"><?php echo $cmynow['res']; ?></td>
    </tr>
    <tr class="tc">
        <td>Mysql相关信息</td>
        <td class="msg"><?php echo "$_cfgs[db_user]:$_cfgs[db_pass]@$_cfgs[db_host]:$_cfgs[db_port] [$_cfgs[db_class]]"; ?></td>
        <td class="tc">---</td>
    </tr>
      <?php if(strstr($cmynow['info'],'Unknown database')){ ?>
    <tr class="tc">
        <td>当前数据库</td>
        <td class="msg">
            <input name="dbname" type="text" id="dbname" value="<?php echo $_cfgs['db_name']; ?>" class="w240" 
              onblur="chkDbname()" reg="var:3-24" tip='修改配置或创建数据库<br>3-24个字母数字下划线组成的标识' />
            <input name="dbnold" type="hidden" id="dbnold" value="<?php echo $_cfgs['db_name']; ?>" />
            修改配置或创建数据库
        </td>
        <td class="tc"><input type="submit" name="bdbedit" id="bdbedit" value="创建" class="btn" /></td>
    </tr>
    <tr>
      <td class="tip" colspan="3">数据库<?php echo $_cfgs['db_name']; ?>不存在；请点[创建] 或 修改[/code/cfgs/boot/cfg_db.php]配置。<a href="?">刷新</a></td>
    </tr> 
      <?php }else{ ?>
    <tr class="tc">
        <td>当前数据库</td>
        <td class="msg">
            $_cfgs['db_name'] = '<?php echo $_cfgs['db_name']; ?>';
        </td>
        <td class="tc">---</td>
    </tr>
    <tr>
      <td class="tip" colspan="3">不能连接Mysql数据库；请修改[/code/cfgs/boot/cfg_db.php]配置，<a href="?">再刷新页面</a>。</td>
    </tr> 
      <?php } ?>
    <?php }else{ ?>
    
    <tr id="step1">
      <td>[1](安装前)环境检测</td>
      <td class="note">(PHP)V5.2+; (GD library)V2.0+; <a href="../adbug/check.php" target="_blank">-=&gt;查看</a><br>
      [mysqli,mysql,pdo]至少支持一个扩展,且可正常连接到Mysql数据库</td>
      <td class="tc"><input name="step1" type="button" value="-开始-" class="btn" onClick="setMain(1);"></td>
    </tr> 
    <tr id="step2">
      <td>[2]安装数据结构</td>
      <td>耐心等待…需要好几秒钟！</td>
      <td class="tc"><input name="step2" type="button" value="等待..." class="btn" onClick="setMain(2);"></td>
    </tr> 
    <tr id="step3">
      <td>[3]安装基本数据</td>
      <td>耐心等待…需要好几秒钟！</td>
      <td class="tc"><input name="step3" type="button" value="等待..." class="btn" onClick="setMain(3);"></td>
    </tr> 
    <tr id="step4">
      <td>[4]安装演示数据</td>
      <td>含: demo,news等演示数据</td>
      <td class="tc"><input name="step4" type="button" value="等待..." class="btn" onClick="setMain(4);"></td>
    </tr> 
    <tr id="step5">
      <td>[5]设置帐号(完成)</td>
      <td>网站名称/管理帐号</td>
      <td class="tc"><input name="step5" type="button" value="等待..." class="btn" onClick="setMain(5);"></td>
    </tr>
    <?php } ?>
  </table>
</div>
</form>

<div id="xform" style="display:none">
  <p>参数设置-网站名称/管理帐号</p>
  <table width="100%" border="1" class="tblist">
    <tr>
      <td class="tr">网站名称</td>
      <td class="tl"><input name="name" value="<?php echo $_cbase['sys_name']; ?>" type="text" id="name" size="24" maxlength="24" reg='str:4-24'>
      <td>4~24个字符</td>
    </tr>
    <tr>
      <td class="tr">管理帐号</td>
      <td class="tl"><input name="uid" value="<?php echo $orguser; ?>" onBlur="chkIdpass(this,0,3)" type="text" id="uid" size="24" maxlength="24" reg='str:3-15'>
      <td>3~15个字符数字下划线组成,且字母开头</td>
    </tr>
    <tr>
      <td class="tr">管理密码</td>
      <td class="tl"><input name="upw" value="<?php echo $orgpass; ?>" onBlur="chkIdpass(this,1,6)" type="text" id="upw" size="24" maxlength="24" reg='str:6-24'>
      <td>6~24个字符数字下划线组成,且字母开头</td>
    </tr> 
    <tr>
      <td class="tc" colspan="2">
      <input type="button" name="button" id="button" value=" -提交完成安装- " onClick="setStp5s(5,1)" class="btn">
      </td>
      <td width="40%">&nbsp;</td>
    </tr>
  </table>
</div>

<div class="tc" id="idLoad" style="display:none">
正在处理……<br>
<img src="<?php echo PATH_STATIC; ?>/icons/basic/loading.gif" style="display:none"></div>
<!--a onclick="loadShow()">show</a> <a onclick="loadStop()">stop</a-->

<div id="xinfo">
  <p>安装程序-安装进度</p>
  <table width="100%" border="1" class="tblist">
    <tr id="resone" class="tc">
      <td>&nbsp;</td>
    </tr> 
    <tr>
      <td>
      <div style="width:96%; height:120px; overflow-y:scroll;" id="reinfo">
      处理结果……
      </div>
      </td>
    </tr>
  </table>
</div>

<script>
<?php echo $setCfgs['jstr']; ?>
var steps = new Array('','Check','Stru','Base','Demo','Idpw');
var nowStep = 0;
setState(); //jsLog(steps[1]);
var orgcfgs = '<?php echo "$orguser,$orgpass"; ?>'.split(',');
var simpass = ',<?php echo implode(',',glbConfig::read('simpass','ex')); ?>,';
var otimer = null;
</script>
